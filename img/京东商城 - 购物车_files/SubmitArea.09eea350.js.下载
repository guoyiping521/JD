/*! JDC_mall_cart 2.0.0 2020-10-30T21:26:39+08:00 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{Ad39:function(e,t,a){"use strict";a.r(t);var n=a("b7r9"),i=a("52aM"),o=a("2MXt"),s=a("0s5v"),c=a("jFLf"),l=a("3Uiq"),r=a("eaAX"),u=a("q1tI"),m=a.n(u),h=a("uufb"),p=a("17x9"),d=a.n(p),f=function(e){if(!e)return 0;for(var t=e.clientTop||0;e;)t+=e.offsetTop||0,e=e.offsetParent;return t},b=window.innerHeight||document.body.clientHeight,v=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(s.a)(this,Object(c.a)(t).call(this,e))).placeholder=void 0,a.content=void 0,a.state={isSticky:!1,wasSticky:!1,style:{}},a.placeholder=null,a.content=null,a.handleContainerEvent=a.handleContainerEvent.bind(Object(l.a)(a)),a}return Object(r.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.placeholder&&setTimeout((function(){var t=e.props.initFixed&&b<f(e.placeholder);e.setState({isSticky:!!t,wasSticky:!!t,style:t?{position:"fixed",transform:"translateZ(0)",top:void 0!==e.props.topOffset&&e.props.topOffset>=0?e.props.topOffset:"auto",bottom:void 0!==e.props.bottomOffset&&e.props.bottomOffset>=0?e.props.bottomOffset:"auto"}:{}})}),0)}},{key:"UNSAFE_componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Must be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder&&(this.placeholder.style.paddingBottom="".concat(this.state.isSticky?this.state.calculatedHeight:0,"px"))}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"handleContainerEvent",value:function(e){var t=e.scrollTop,a=e.eventSource;if(this.content&&this.placeholder){var n=this.context.getParent(),i=this.props,o=i.topOffset,s=i.bottomOffset,c=i.initFixed,l=!1;this.props.relative&&(l=a!==n);var r=this.content.getBoundingClientRect().height,u=!!this.state.isSticky,m=!1,p={};l&&(m=u),!l&&this.props.relative?(void 0!==s&&s>=0&&(p.bottom=s,m=t>n.offsetTop-this.placeholder.offsetTop+r),void 0!==o&&o>=0&&(p.top=o,m=t>n.offsetTop-this.placeholder.offsetTop),m?(p.position="absolute",p.transform="translateZ(0)"):(p.position="static",p.transform="none")):this.props.relative||a===n||(m=u,void 0!==s&&s>=0&&!c&&(p.bottom=s,m=t>f(this.placeholder)+r),void 0!==s&&s>=0&&c&&(p.bottom=s,m=t+b<f(this.placeholder)+r),void 0!==o&&o>=0&&!c&&(p.top=o,m=t>f(this.placeholder)),void 0!==o&&o>=0&&c&&(p.top=o,m=t+b<f(this.placeholder)),m?(p.position="fixed",p.transform="translateZ(0)"):(p.position="static",p.transform="none"));var d=Object(h.a)({},this.state.style,p);this.setState({isSticky:m,wasSticky:u,calculatedHeight:r,style:d})}}},{key:"render",value:function(){var e=this,t=m.a.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=t}});return m.a.createElement("div",null,m.a.createElement("div",{ref:function(t){e.placeholder=t}}),t)}}]),t}(u.PureComponent);v.defaultProps={relative:!1,topOffset:-1,bottomOffset:-1,initFixed:!1},v.contextTypes={subscribe:d.a.func,unsubscribe:d.a.func,getParent:d.a.func};var k=a("Tby2"),E=a("xEkU"),g=a.n(E),y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(s.a)(this,Object(c.a)(t).call(this,e))).framePending=void 0,a.subscribers=void 0,a.rafHandle=void 0,a.node=void 0,a.events=void 0,a.events=["scroll"],a.framePending=!1,a.subscribers=[],a.rafHandle=null,a.node=null,a.subscribe=a.subscribe.bind(Object(l.a)(a)),a.unsubscribe=a.unsubscribe.bind(Object(l.a)(a)),a.notifySubscribers=a.notifySubscribers.bind(Object(l.a)(a)),a.getParent=a.getParent.bind(Object(l.a)(a)),a}return Object(r.a)(t,e),Object(o.a)(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(g.a.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"getParent",value:function(){return this.node}},{key:"subscribe",value:function(e){this.subscribers=this.subscribers.concat(e)}},{key:"unsubscribe",value:function(e){this.subscribers=this.subscribers.filter((function(t){return t!==e}))}},{key:"notifySubscribers",value:function(e){var t=this;if(!this.framePending){var a=e.currentTarget;this.rafHandle=g()((function(){t.framePending=!1;var e,n=(e=a)===window?window.document.body.scrollTop||document.documentElement.scrollTop:e.scrollTop;t.subscribers.forEach((function(e){return e({scrollTop:n,eventSource:a===window?document.body:t.node})}))})),this.framePending=!0}}},{key:"render",value:function(){var e=this;return m.a.createElement("div",Object(k.a)({},this.props,{ref:function(t){e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(u.PureComponent);y.childContextTypes={subscribe:d.a.func,unsubscribe:d.a.func,getParent:d.a.func};a("npXv");var S=a("7iOr"),T=a("XQo9"),w=a("mEyV"),C=a("/MKj"),N=a("8SmY"),O=a("I8w6"),D=a("CgT+"),P=a("aONd"),I=a("e36g"),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(s.a)(this,Object(c.a)(t).call(this,e))).followBtn=void 0,a.getSkus=function(){var e=a.props.checkList,t=[];return e.forEach((function(e){if(e.itemType===O.a.PRODUCT_ITEM)t.push(e.item);else if(e.itemType===O.a.PRODUCT_COMBINE_MANFAN||e.itemType===O.a.PRODUCT_COMBINE_MANZENG){var a=e.item.items.map((function(e){return e.item}));t=[].concat(Object(n.a)(t),Object(n.a)(a))}})),t},a.getChosedSkus=function(){var e=a.props.checkList,t=[];return e.forEach((function(e){e.itemType===O.a.PRODUCT_ITEM?t.push(e.item.Id):e.itemType!==O.a.PRODUCT_COMBINE_MANFAN&&e.itemType!==O.a.PRODUCT_COMBINE_MANZENG||e.item.items.map((function(e){1===e.item.CheckType&&t.push(e.item.Id)}))})),t},a.followListDo=function(){var e=a.getChosedSkus();if(e.length>50)var t=S.a.confirm({title:"",closeButton:!0,outsideClose:!0,hasMask:!0,isOpen:!0,width:404,height:242,className:"",children:m.a.createElement(w.a,{dialogSubmit:function(){return t.close()},type:"error",submitBtnText:"知道了",innerText:m.a.createElement("div",null,m.a.createElement("p",{className:"common-tips-tit"},"最多选中50件商品！"))})});else{var n=a.followBtn.getBoundingClientRect();a.closeDialog(),Object(I.a)(e.join(",")).then((function(e){e&&e.success&&(T.a.showMsg({showIcon:!0,type:"success",description:"成功移入关注！",autohide:!0,closable:!1,duration:3e3,style:{left:n.left,top:n.top-30}}),a.deleteCheckList(!0))}))}},a.state={isDialogShow4BatDel:!1,isDialogShow4Follow:!1,isDialogShowEmptyDel:!1,isPromotionBestSimpleShow:!1},a.checkAll=a.checkAll.bind(Object(l.a)(a)),a.deleteCheck=a.deleteCheck.bind(Object(l.a)(a)),a.deleteCheckList=a.deleteCheckList.bind(Object(l.a)(a)),a.showDialog4BatDel=a.showDialog4BatDel.bind(Object(l.a)(a)),a.closeDialog=a.closeDialog.bind(Object(l.a)(a)),a.changePromotion=a.changePromotion.bind(Object(l.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(l.a)(a)),a.followList=a.followList.bind(Object(l.a)(a)),a.followCheck=a.followCheck.bind(Object(l.a)(a)),a}return Object(r.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.cartInfo;t&&(t.promotionTotalInfo&&setTimeout((function(){e.setState({isPromotionBestSimpleShow:!0})}),5e3))}},{key:"render",value:function(){var e=this,t=this.props.cartInfo,a=this.state.isPromotionBestSimpleShow,n=t.unusableSkus&&t.unusableSkus.length>0?t.unusableSkus.length:0,i=t.cartNum-n;if(!t)return null;var o=this.state,s=o.isDialogShow4BatDel,c=o.isDialogShow4Follow,l=o.isDialogShowEmptyDel,r=t.PriceShow,u=t.checkedWareNum,h=(t.RePrice,t.checkType),p=t.promotionTotalInfo,d=t.preferentialSummary,f=t.checkedCartState,b={title:"",closeButton:!0,outsideClose:!0,hasMask:!0,isOpen:l,width:404,height:242,className:"",children:m.a.createElement(w.a,{dialogSubmit:function(){e.setState({isDialogShowEmptyDel:!1})},type:"error",submitBtnText:"知道了",innerText:m.a.createElement("div",null,m.a.createElement("p",{className:"common-tips-tit"},"请至少选中一件商品！"))}),onClose:function(){return e.closeDialog()}},k={title:"",closeButton:!0,outsideClose:!0,hasMask:!0,isOpen:s,width:404,height:242,className:"",children:m.a.createElement(w.a,{dialogSubmit:this.followList,dialogCancel:function(){e.deleteCheckList()},type:"error",submitBtnText:"移入关注",cancelBtnText:"删除商品",innerText:m.a.createElement("div",null,m.a.createElement("p",{className:"common-tips-tit"},"删除选中商品"),m.a.createElement("p",{className:"common-tips-cont"},"您可以选择移入关注，或删除商品"))}),onClose:function(){return e.closeDialog()}},E={title:"",closeButton:!0,outsideClose:!0,hasMask:!0,isOpen:c,width:404,height:242,className:"",children:m.a.createElement(w.a,{dialogSubmit:this.followList,dialogCancel:this.closeDialog,type:"error",submitBtnText:"确定",cancelBtnText:"取消",innerText:m.a.createElement("div",null,m.a.createElement("p",{className:"common-tips-tit"},"移入关注"),m.a.createElement("p",{className:"common-tips-cont"},"移动后选中商品将不在购物车中显示"))}),onClose:function(){return e.closeDialog()}};return m.a.createElement(m.a.Fragment,null,m.a.createElement(y,null,m.a.createElement(v,{bottomOffset:0,initFixed:!0},(function(t){var a=t.style,n=t.isSticky;return m.a.createElement("div",{className:"cart-floatbar ".concat(n?"cart-floatbar-fixed":""),style:a},m.a.createElement("div",{className:"cart-floatbar"},m.a.createElement("div",{className:"cart-toolbar"},m.a.createElement("div",{className:"toolbar-wrap"},m.a.createElement("input",{type:"hidden",value:f,id:"checkedCartState"}),m.a.createElement("div",{className:"selected-item-list hide"}),m.a.createElement("div",{className:"options-box"},m.a.createElement("div",{className:"left"},m.a.createElement("div",{className:"select-all"},m.a.createElement("input",{type:"checkbox",disabled:i<=0,className:"jdcheckbox",checked:1===h,onChange:function(){return e.checkAll(h)},clstag:"pageclick|keycount|Shopcart_CheckAll|".concat(1===h?1:0)}),"全选"),m.a.createElement("div",{className:"operation"},m.a.createElement("a",{href:"#none",className:"opt-batch-remove",onClick:e.deleteCheck},"删除选中的商品"),m.a.createElement("a",{href:"#none",className:"opt-batch-follow",onClick:e.followCheck,ref:function(t){return e.followBtn=t}},"移入关注"),m.a.createElement("a",{href:"#none",className:"opt-cleaner",title:"亲，点我可快速清理购物车商品哦！"},m.a.createElement("strong",{id:"J_opt_cart_cleaner"},"清理购物车")))),m.a.createElement("div",{className:"right"},m.a.createElement("div",{className:"combine"},m.a.createElement("div",{className:"btn-area"},3===f&&m.a.createElement("a",{className:"jdInt-submit-btn-hd",href:"//authorize.jd.hk/auth/auth.action",clstag:"pageclick|keycount|Shopcart_Pay|1"},"去京东国际结算",m.a.createElement("b",null)),m.a.createElement("a",{className:"common-submit-btn",href:"#none",onClick:function(){return e.handleSubmit(f)},clstag:"pageclick|keycount|Shopcart_Pay|0"},"去结算",m.a.createElement("b",null))),m.a.createElement("div",{className:"price-sum"},m.a.createElement("div",null,m.a.createElement("div",{className:"price-show"},m.a.createElement("span",{className:"txt"},"总价："),m.a.createElement("span",{className:"price priceShow"},m.a.createElement("em",null,r)),m.a.createElement("b",{className:"ml5 price-tips"}),m.a.createElement("div",{className:"price-tipsbox-new"},m.a.createElement("div",{className:"ui-tips-main"},"不含运费及送装服务费"),m.a.createElement("span",{className:"price-tipsbox-arrow"}))),m.a.createElement("span",{className:"amount-sum"},"已选择",m.a.createElement("em",null,u),"件商品",m.a.createElement("b",{className:"up"})),m.a.createElement("br",null),d&&m.a.createElement("div",{className:"price-sum-extra"},d.promotionPrice&&m.a.createElement(m.a.Fragment,null,m.a.createElement("span",{className:""},"促销："),m.a.createElement("span",{className:""},"-",d.promotionPrice)),d.couponSavedPrice&&m.a.createElement(m.a.Fragment,null,m.a.createElement("span",{className:"ml5"},"优惠券："),m.a.createElement("span",{className:""},"-",d.couponSavedPrice)),d.discountReprice&&m.a.createElement(m.a.Fragment,null,m.a.createElement("span",{className:"ml5"},"PLUS95折",m.a.createElement("i",{className:"plus-95-tips",title:d.balanceAmount?"本月剩余月优惠额度：".concat(d.balanceAmount):""})," ","："),m.a.createElement("span",{className:""},"-",d.discountReprice))))),m.a.createElement("div",{className:"clr"}))))))))})),p&&m.a.createElement(v,{bottomOffset:0,initFixed:!0},(function(t){t.style;var n=t.isSticky;return a?m.a.createElement("div",{className:"promotion-best-bottom"},m.a.createElement("div",{className:"ac"},m.a.createElement("span",{className:"bottom-toast",onClick:e.changePromotion},m.a.createElement("p",null,"立省"),m.a.createElement("p",null,m.a.createElement("em",null,m.a.createElement("b",null,"￥"),Math.round(p.promotionSavePriceTotal)))))):m.a.createElement("div",{className:"promotion-best-bottom ".concat(n?"fixed-bottom":""),style:{bottom:"53px",backgroundColor:"inherit",boxShadow:"none"}},m.a.createElement("div",{className:"ac"},m.a.createElement("span",{className:"bottom-continer"},m.a.createElement("span",{className:"info"},"已选商品有更优惠促销，修改后立省",m.a.createElement("em",null,m.a.createElement("b",null,"￥"),Math.round(p.promotionSavePriceTotal))),m.a.createElement("span",{className:"btn",onClick:e.changePromotion},m.a.createElement("a",{href:"#none",id:"promoRelaButton"},"修改")))))}))),m.a.createElement(S.a,b),m.a.createElement(S.a,k),m.a.createElement(S.a,E))}},{key:"deleteCheckList",value:function(e){var t=this;if(this.props.optCartRemove){var a={operations:[{carttype:D.a.CART_TYPE_DELETE,TheSkus:[],ThePacks:[]}]};this.setState({isDialogShow4BatDel:!1}),this.props.checkList.map((function(e){var n=t.inputParam(e);n.operations[0].TheSkus&&a.operations[0].TheSkus.push(n.operations[0].TheSkus[0]),n.operations[0].ThePacks&&a.operations[0].ThePacks.push(n.operations[0].ThePacks[0])}));var n=e?null:this.getSkus();this.props.optCartRemove({RequestParam:a,itemInfo:n})}}},{key:"followList",value:function(){var e=this.props,t=e.isLogin,a=e.loadLogin,n=this;t?this.followListDo():this.setState({isDialogShow4BatDel:!1,isDialogShow4Follow:!1},(function(){window.cartLogin({modal:!0,complete:function(){a(),n.followListDo()}})}))}},{key:"deleteCheck",value:function(){0!==this.props.checkList.length?this.setState({isDialogShow4BatDel:!0}):this.setState({isDialogShowEmptyDel:!0})}},{key:"followCheck",value:function(){if(0!==this.props.checkList.length)if(this.props.checkList.length>50)var e=S.a.confirm({title:"",closeButton:!0,outsideClose:!0,hasMask:!0,isOpen:!0,width:404,height:242,className:"",children:m.a.createElement(w.a,{dialogSubmit:function(){return e.close()},type:"error",submitBtnText:"知道了",innerText:m.a.createElement("div",null,m.a.createElement("p",{className:"common-tips-tit"},"最多选中50件商品！"))})});else this.setState({isDialogShow4Follow:!0});else this.setState({isDialogShowEmptyDel:!0})}},{key:"checkAll",value:function(e){e?this.props.optCartUnCheckAll():this.props.optCartCheckAll()}},{key:"showDialog4BatDel",value:function(){this.setState({isDialogShow4BatDel:!0})}},{key:"closeDialog",value:function(){this.setState({isDialogShow4BatDel:!1,isDialogShow4Follow:!1,isDialogShowEmptyDel:!1})}},{key:"changePromotion",value:function(){var e=this.props.cartInfo;if(e){var t=e.promotionTotalInfo,a=t&&t.promotionPriceInfo,n={serInfo:{area:Object(P.a)()},operations:[{promotionPriceInfo:a}]};this.props.optCartChangePromotion({RequestParam:n})}}},{key:"inputParam",value:function(e){var t=e.itemType,a=e.item.Id,n=e.item.Num,i=e.item.SType;16===i&&0!==e.item.items.length&&(i=13);var o=[];switch(t){case O.a.PRODUCT_ITEM:return{operations:[{TheSkus:[{Id:a,num:n,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid}]}]};case O.a.PRODUCT_SUIT:return{operations:[{carttype:D.a.CART_TYPE_DELETE,ThePacks:[{Id:a,ybPackId:e.item.vskuId?e.item.vskuId:a,num:n,sType:i,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid,TheSkus:o}]}]};case O.a.PRODUCT_COMBINE_MANFAN:return e.item.items.map((function(e){var a;1===e.item.CheckType&&(4==e.itemType?(a=12==t?29:24,o.push({Id:e.item.Id,num:e.item.Num,sType:a,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid})):o.push({Id:e.item.Id,num:e.item.Num,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid}))})),{operations:[{carttype:D.a.CART_TYPE_DELETE,ThePacks:[{Id:a,num:n,sType:i,TheSkus:o}]}]};case O.a.PRODUCT_COMBINE_MANZENG:return e.item.items.map((function(e){var a;1===e.item.CheckType&&(4==e.itemType?(a=12==t?29:24,o.push({Id:e.item.Id,num:e.item.Num,sType:a,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid})):o.push({Id:e.item.Id,num:e.item.Num,skuUuid:e.item.skuUuid,useUuid:e.item.useUuid}))})),{operations:[{carttype:D.a.CART_TYPE_DELETE,ThePacks:[{Id:a,num:n,sType:i,TheSkus:o}]}]};default:return null}}},{key:"handleSubmit",value:function(e){var t="//trade.jd.com/shopping/order/getOrderInfo.action";switch(e){case 1:case 3:window.location.href=t;break;case 2:window.location.href="//authorize.jd.hk/auth/auth.action";break;case 4:this.setState({isDialogShowEmptyDel:!0});break;case 5:window.location.href="".concat(t,"?overseaMerge=1")}}}]),t}(u.PureComponent),U=Object(C.b)((function(e){return{cartInfo:e.cartInfo?e.cartInfo.data:null,checkList:e.checkList?e.checkList.data:[],isLogin:!!e.isLogin&&e.isLogin.isLogin}}),{optCartCheckAll:N.X,optCartUnCheckAll:N.eb,optCartRemove:N.ab,optCartChangePromotion:N.W,loadLogin:N.S})(j);t.default=U},npXv:function(e,t,a){}}]);